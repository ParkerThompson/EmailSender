<h1>Email Sender</h1>
<h2>How To Run</h2>

<h3>Setup</h3>
Set the API keys in application-sendgrid.properties and application-snailgun.properties
I didn't want to put these into source control but also did not have time to setup a proper
secrets manager. I discuss this further in the Future Improvements section.

<h3>Run directly</h3>
Run this command in the root project directory
<br>./mvnw spring-boot:run

<h3>Run in Docker</h3>
Run the following commands in the root project directory
<br>./mvnw clean install
<br>docker build -t emailsender .
<br>docker run -p 8080:8080 emailsender:latest

<h2>API Documentation</h2>
Autogenerated API documentation is available when the service is running at
http://localhost:8080/swagger-ui.html#/email-controller

<h2>Changing the email service</h2>
To change between snailgun and sendgrid change the spring.profiles.active value in 
applicaiton.properties to either sendgrid or snailgun

<h2>Languages, Frameworks, and Libraries</h2>
<h3>Languages</h3>
I chose to write this in Java because it's the language I have the most familiarity 
with and it has good frameworks for quickly making REST services. 
creating REST services;
<h3>Frameworks</h3>
I build this service in Springboot as that is the industry standard for Java REST 
services and a framework I have a great deal of familiarity with.
<h3>Libraries</h3>
<h4>Apache Commons Validator</h4>
I used this library for Email Addres Validation.
The reason I decided to use a library rather than do it myself is that some cursory online research 
revealed that there are a ton of edge cases. I felt that this was a situation where it was better to not 
reinvent the wheel. I chose apache commons validator due to ease of use, but it is not completely comprehensive. 
I discuss some options for more comprehensive validators in the Future Improvements sections
<h5>Some references on email validation</h5>
https://davidcel.is/posts/stop-validating-email-addresses-with-regex/
<br>https://stackoverflow.com/questions/201323/how-to-validate-an-email-address-using-a-regular-expression
<h4>Jsoup</h4>
I used Jsoup to help convert HTML to plaintext. I felt that, as with email address validation, There were a lot of 
edge cases and this is a common problem that existing libraries have already solved. 
<h4>Gson</h4>
I used the Gson library for JSON parsing. Mostly in tests but also to map snailguns snake case
parameters to camel case
<h4>Swagger</h4>
I used this as a quick easy way to create API documentation.
<h3>Other Technologies</h3>
<h4>Maven</h4>
I used Maven as a build tool primarily due to familiarity. I could have also chosen to use Gradle and the differences 
between the two on a project like this are fairly minimal 
<h4>Docker</h4>
I created a Dockerfile because it is industry standard and I knew it could add it very quickly
<h2>Other decisions</h2>
<h3>EmailController</h3>
This is a pretty thin passthrough. It does a little bit of validation and then routes requests to
the EmailService
<h3>Email</h3>
I created this to be a message class separate from individual messages based on Sendgrid or Snailgun
<h4>Validation<h4>
I decided to make the validation a separate method within Email rather than something that is 
enforced on creation because Springboot autowiring doesn't always call setter methods. So the only enforced option I was left with
was to put it in the constructor but that would mean it was not possible to create a no args constructor and made 
testing much more difficult. So ultimately I decided that correctness should be enforced when the message was actually
sent. This has the advantage of making it easier to create multiple different validations for different services.
<h4>HTML to plaintext</h4>
Because of the lack of guarantee that setters would be called discussed above, the HTML to plaintext
transformation was also done at this time.
<h3>Requests</h3>
These mostly just map to what the APIs are expecting. The one notable thing here is a created
an empty interface so I could use a parameterized method that could take either kind of request.
<h3>Services</h3>
I created an abstract email service that has all the common code
<h4>Send email</h4>
The actual sending is done by the abstract class and the child services just prepare the request
<h4>Get Status</h4>
Snailgun returns the actual status while sendgrid throws an exception letting the user know
that the endpoint is not currently usable. 

<h2>Future Improvements</h2>
<h3>Secrets Manager</h3>
This is the biggest area of improvement in my opinion. Currently, API keys must be put in
manually but there are technologies that exist that could help. Two that I would look into
are Spring Vault and Kubernetes secrets.
<h3>More Comprehensive Email Validation</h3>
This would require more research but there are more comprehensive validators than the one
I used. The downside is a potentially cost in speed. This would have to be balanced.
<h3>500 errors on unknown ids</h3>
This is actually an improvement to the email API itself but I noticed it responds to unknown 
email ids with a 500 error. I think this should be replaced with a friendlier error that leaks 
less technical information.
<h3>Kubernetes</h3>
It would also be nice to implement Kubernetes to make deployment easier and increase reliablility
One area of future exploration would be looking at the trade-offs of a more comprehensive validation. Some potential options are email-rfc2822-validator and EmailValidator4J
